def logic(brainfuck_mapping, index)
  ascii = brainfuck_mapping[index][1]
  output = brainfuck_mapping[index][2]
  detection = ""

  (2..ascii).each do |i|
    detection += "-"
  end

  "< [-]
< [-]
< [-]
< [-]+
< [-]+
>>>>>

[-<+<+>>]
<[->+<]<

#{detection}
[
  <+
  >-
  [
    <<->>
    [-]
  ]
  <
  [
    <
    [
      >[-]<[-]
      #{output}

      <
      [-]
      >

      [-]
    ]
    >
    [-]
  ]
  >
]

#{continuation(brainfuck_mapping, index + 1)}"
end

def continuation(brainfuck_mapping, index)
  if index >= brainfuck_mapping.length
    ""
  else
    "<<<
[
  >>>>>
  #{logic(brainfuck_mapping, index)}
  <<<
]
>>>"
  end
end

def brainfuckify(text, ascii_mapping)
  text.chars.map do |character|
    ascii = ascii_mapping[character]
    (1..ascii).map do |i| "+" end.join
  end.join(">")
end

ascii_mapping = {
  "0" => 48,
  "1" => 49,
  "2" => 50,
  "3" => 51,
  "4" => 52,
  "5" => 53,
  "6" => 54,
  "7" => 55,
  "8" => 56,
  "9" => 57,
  "a" => 97,
  "b" => 98,
  "c" => 99,
  "d" => 100,
  "e" => 101,
  "f" => 102,
  "g" => 103,
  "h" => 104,
  "i" => 105,
  "j" => 106,
  "k" => 107,
  "l" => 108,
  "m" => 109,
  "n" => 110,
  "o" => 111,
  "p" => 112,
  "q" => 113,
  "r" => 114,
  "s" => 115,
  "t" => 116,
  "u" => 117,
  "v" => 118,
  "w" => 119,
  "x" => 120,
  "y" => 121,
  "z" => 122,
  " " => 32
}

brainfuck_mapping = [
  ["0", 48, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["1", 49, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["2", 50, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["3", 51, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["4", 52, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["5", 53, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["6", 54, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["7", 55, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["8", 56, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["9", 57, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["a", 97, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["b", 98, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["c", 99, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["d", 100, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["e", 101, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]"],
  ["f", 102, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["g", 103, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["h", 104, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["i", 105, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["j", 106, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["k", 107, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["l", 108, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["m", 109, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["n", 110, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["o", 111, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["p", 112, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["q", 113, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["r", 114, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]"],
  ["s", 115, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  ["t", 116, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]"],
  ["u", 117, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["v", 118, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["w", 119, ">-[-----<+>]<---.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["x", 120, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]"],
  ["y", 121, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]"],
  ["z", 122, ">-[-----<+>]<---.[-]>-[---<+>]<------.[-]>-[---<+>]<------.[-]>+[-------<++>]<+.[-]>+[-------<++>]<+.[-]"],
  [" ", 32, ">-[-----<+>]<---.[-]>+[-----<+++>]<++++.[-]>++++[-<++++++++>]<.[-]"],
]

reserve_registers = ">>>>>"

input = brainfuckify(ARGV[0], ascii_mapping)

move_to_start = "[<]>"

start_loop="["
end_loop = "]"
goto_next_character = ">>>"
print_trailing_k = ">+[----->+++<]>++++."

p code = "#{reserve_registers}
#{input}
#{move_to_start}

#{start_loop}
  #{logic(brainfuck_mapping, 0)}
  #{goto_next_character}
#{end_loop}

#{print_trailing_k}".gsub("\n", "").gsub(" ", "")
